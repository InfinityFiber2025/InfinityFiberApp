<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Infinity Fiber App v5.0</title>
  <link rel="manifest" href="manifest.json">
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').then(() => console.log("SW registrado"));
    }
  </script>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #0f172a; color: #fff; }
    header { background:#1e293b; padding:10px; text-align:center; }
    nav { position: fixed; bottom: 0; width: 100%; background: #1e293b; display: flex; justify-content: space-around; padding: 10px; }
    nav button { background: none; border: none; color: #fff; font-size: 14px; cursor: pointer; }
    .tab { display: none; padding: 20px; }
    .active { display: block; }
    input, select, button { margin-top: 10px; padding: 10px; border-radius: 8px; border: none; }
    input, select { width: 95%; }
    button { background: #00d4ff; color:#000; cursor:pointer; }
    button:hover { background:#00b6e0; }
    video { margin-top:10px; border:3px solid #00d4ff; border-radius:12px; }
  </style>
</head>
<body>

<header><h1>Infinity Fiber App v5.0</h1></header>

<!-- Aba Login -->
<div id="t-login" class="tab active">
  <h2>Login</h2>
  <input id="user" placeholder="Usuário"><br>
  <input id="pass" type="password" placeholder="Senha"><br>
  <button onclick="doLogin()">Entrar</button>
</div>

<!-- Aba Home -->
<div id="t-home" class="tab">
  <h2>Dashboard</h2>
  <p>Saldo disponível: <span id="saldo">R$ ****</span> <button onclick="mostrarSaldo()">Mostrar</button></p>
  <h3>Últimas transações</h3>
  <ul id="ultimas"></ul>
</div>

<!-- Aba Transferência -->
<div id="t-transferencia" class="tab">
  <h2>Transferência</h2>
  <label>Tipo:</label>
  <select id="tipo">
    <option>PIX</option>
    <option>TED</option>
    <option>DOC</option>
    <option>Entre contas Infinity</option>
  </select><br>
  <input id="destino" placeholder="Chave PIX / Conta destino"><br>
  <input id="valor" placeholder="Valor"><br>
  <input id="descricao" placeholder="Descrição"><br>
  <button onclick="fazerTransferencia()">Confirmar</button>
  <h3>Histórico</h3>
  <ul id="historico"></ul>
</div>

<!-- Aba Cadastro -->
<div id="t-cadastro" class="tab">
  <h2>Cadastro de Cliente</h2>
  <input id="nome" placeholder="Nome completo"><br>
  <input id="cpf" placeholder="CPF/CNPJ"><br>
  <input id="email" placeholder="Email"><br>
  <input id="tel" placeholder="Telefone"><br>
  <button onclick="cadastrarCliente()">Cadastrar</button>
  <h3>Clientes</h3>
  <ul id="listaClientes"></ul>
</div>

<!-- Aba Facial -->
<div id="t-facil" class="tab">
  <h2>Validação Facial</h2>
  <select id="cameras"></select><br>
  <button id="start">Abrir câmera</button><br>
  <video id="video" width="320" height="240" autoplay></video><br>
  <button id="uploadBtn">Usar foto (upload)</button>
  <input type="file" id="uploadInput" accept="image/*" style="display:none;">
</div>

<!-- Aba IA -->
<div id="t-ia" class="tab">
  <h2>Atendimento IA</h2>
  <input id="duvida" placeholder="Digite sua dúvida"><br>
  <button onclick="buscarIA()">Buscar</button>
  <div id="respostaIA"></div>
</div>

<!-- Aba Configurações -->
<div id="t-config" class="tab">
  <h2>Configurações</h2>
  <button onclick="localStorage.clear(); alert('Dados limpos!')">Limpar dados locais</button>
  <button onclick="logout()">Logout</button>
</div>

<nav>
  <button onclick="showTab('t-home')">🏠 Home</button>
  <button onclick="showTab('t-transferencia')">💸 Transferência</button>
  <button onclick="showTab('t-cadastro')">🧑‍💼 Cadastro</button>
  <button onclick="showTab('t-facil')">🧑‍🦱 Facial</button>
  <button onclick="showTab('t-ia')">🤖 IA</button>
  <button onclick="showTab('t-config')">⚙️ Config</button>
</nav>

<script>
let currentStream;
let clientes = JSON.parse(localStorage.getItem("clientes")||"[]");
let historico = JSON.parse(localStorage.getItem("historico")||"[]");

// Navegação
function showTab(id){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

// Login
function doLogin(){
  if(document.getElementById('user').value==="DanielKascher" && document.getElementById('pass').value==="K@scher123"){
    showTab('t-home');
  } else alert("Usuário ou senha incorretos!");
}
function logout(){ showTab('t-login'); }

// Saldo
function mostrarSaldo(){
  document.getElementById('saldo').innerText="R$ 37.743.623,00";
}

// Transferência
function fazerTransferencia(){
  if(localStorage.getItem("facial_validado")!=="true"){
    alert("⚠️ Faça a validação facial antes da transferência.");
    return;
  }
  let item={tipo:tipo.value,dest:destino.value,valor:valor.value,desc:descricao.value};
  historico.unshift(item);
  if(historico.length>5) historico.pop();
  localStorage.setItem("historico",JSON.stringify(historico));
  renderHistorico();
  alert("✅ Transferência concluída!");
}
function renderHistorico(){
  historico=document.createElement?historico:JSON.parse(localStorage.getItem("historico")||"[]");
  document.getElementById('historico').innerHTML=historico.map(h=>"<li>"+h.tipo+" - "+h.dest+" - R$"+h.valor+"</li>").join("");
}
renderHistorico();

// Cadastro
function cadastrarCliente(){
  let c={nome:nome.value,cpf:cpf.value,email:email.value,tel:tel.value};
  clientes.push(c);
  localStorage.setItem("clientes",JSON.stringify(clientes));
  renderClientes();
}
function renderClientes(){
  document.getElementById('listaClientes').innerHTML=clientes.map(c=>"<li>"+c.nome+" - "+c.cpf+"</li>").join("");
}
renderClientes();

// IA
function buscarIA(){
  let q=document.getElementById('duvida').value.toLowerCase();
  let r="Desculpe, não encontrei.";
  if(q.includes("pix")) r="Para transferir via PIX, selecione o tipo PIX e informe a chave.";
  if(q.includes("cadastro")) r="O cadastro pede Nome, CPF, Email e Telefone.";
  document.getElementById('respostaIA').innerText=r;
}

// Facial
async function listarCameras(){
  try {
    const devices = await navigator.mediaDevices.enumerateDevices();
    const cameras = devices.filter(d=>d.kind==="videoinput");
    const select=document.getElementById('cameras');
    select.innerHTML="";
    cameras.forEach((cam,i)=>{
      const option=document.createElement('option');
      option.value=cam.deviceId;
      option.text=cam.label||`Câmera ${i+1}`;
      select.appendChild(option);
    });
  } catch(err){ console.error(err); }
}
async function abrirCamera(){
  if(currentStream){ currentStream.getTracks().forEach(track=>track.stop()); }
  const deviceId=document.getElementById('cameras').value;
  try{
    const stream=await navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:deviceId}}});
    currentStream=stream;
    document.getElementById('video').srcObject=stream;
    localStorage.setItem("facial_validado","true");
    alert("✅ Validação facial concluída!");
  }catch(err){ alert("Erro ao acessar a câmera: "+err); }
}
document.getElementById('start').onclick=abrirCamera;
document.getElementById('uploadBtn').onclick=()=>document.getElementById('uploadInput').click();
document.getElementById('uploadInput').onchange=()=>{ localStorage.setItem("facial_validado","true"); alert("✅ Validação facial concluída via upload!"); };
listarCameras();
</script>

</body>
</html>