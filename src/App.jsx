// O código unificado completo já está no canvas (não incluímos aqui para brevidade)